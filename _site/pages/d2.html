
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Discussion 2</title>
    <meta name="author" content="Linquan Ma">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://mlqmlq.github.io/STAT628/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="http://mlqmlq.github.io/STAT628/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="http://mlqmlq.github.io/STAT628/assets/themes/twitter/css/main.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->

    <!-- atom & rss feed -->
    <link href="nil" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="nil" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Data Science Practicum - STAT 628 - Fall 2020</a>
          <ul class="nav">
              <li><a href="/pages/schedule.html">schedule</a></li>
          </ul>

        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h2>Discussion 2 </h2>
</div>

<div class="row-fluid">
  <div class="span12">
    <h2 id="dplyr">dplyr</h2>
<p>is a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges. There are five common commands:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">mutate()</code> adds new variables that are functions of existing variables</li>
  <li><code class="language-plaintext highlighter-rouge">select()</code> picks variables based on their names</li>
  <li><code class="language-plaintext highlighter-rouge">filter()</code> picks cases based on their values</li>
  <li><code class="language-plaintext highlighter-rouge">summarise()</code> reduces multiple values down to a single summary</li>
  <li><code class="language-plaintext highlighter-rouge">arrange()</code> changes the ordering of the rows</li>
</ul>

<h3 id="prerequisites">Prerequisites</h3>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">nycflights13</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="nycflights13">nycflights13</h3>
<p>We use the dataset <code class="language-plaintext highlighter-rouge">flights</code>, which contains all 336,776 flights that departed from New York City in 2013.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flights</span><span class="w">
</span><span class="c1">#&gt; # A tibble: 336,776 x 19</span><span class="w">
</span><span class="c1">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><span class="w">
</span><span class="c1">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><span class="w">
</span><span class="c1">#&gt; 1  2013     1     1      517            515         2      830            819</span><span class="w">
</span><span class="c1">#&gt; 2  2013     1     1      533            529         4      850            830</span><span class="w">
</span><span class="c1">#&gt; 3  2013     1     1      542            540         2      923            850</span><span class="w">
</span><span class="c1">#&gt; 4  2013     1     1      544            545        -1     1004           1022</span><span class="w">
</span><span class="c1">#&gt; 5  2013     1     1      554            600        -6      812            837</span><span class="w">
</span><span class="c1">#&gt; 6  2013     1     1      554            558        -4      740            728</span><span class="w">
</span><span class="c1">#&gt; # … with 336,770 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span><span class="w">
</span><span class="c1">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span><span class="w">
</span><span class="c1">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span><span class="w">
</span></code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">&lt;dbl&gt;</code> suggests the corresponding column is of class <code class="language-plaintext highlighter-rouge">double</code>, i.e., a double-precision floating point number.</p>
<h3 id="tibble">tibble</h3>
<p>We see that the variable type is of <code class="language-plaintext highlighter-rouge">tibble</code>, which is a modern reimagining of the data.frame, keeping what time has proven to be effective, and throwing out what is not.</p>

<p>We can create a tibble from an existing object with <code class="language-plaintext highlighter-rouge">as_tibble()</code>:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">as_tibble</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; # A tibble: 150 x 5</span><span class="w">
</span><span class="c1">#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span><span class="w">
</span><span class="c1">#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span><span class="w">
</span><span class="c1">#&gt;  1          5.1         3.5          1.4         0.2 setosa </span><span class="w">
</span><span class="c1">#&gt;  2          4.9         3            1.4         0.2 setosa </span><span class="w">
</span><span class="c1">#&gt;  3          4.7         3.2          1.3         0.2 setosa </span><span class="w">
</span><span class="c1">#&gt;  4          4.6         3.1          1.5         0.2 setosa </span><span class="w">
</span><span class="c1">#&gt;  5          5           3.6          1.4         0.2 setosa </span><span class="w">
</span><span class="c1">#&gt;  6          5.4         3.9          1.7         0.4 setosa </span><span class="w">
</span><span class="c1">#&gt;  7          4.6         3.4          1.4         0.3 setosa </span><span class="w">
</span><span class="c1">#&gt;  8          5           3.4          1.5         0.2 setosa </span><span class="w">
</span><span class="c1">#&gt;  9          4.4         2.9          1.4         0.2 setosa </span><span class="w">
</span><span class="c1">#&gt; 10          4.9         3.1          1.5         0.1 setosa </span><span class="w">
</span><span class="c1">#&gt; # … with 140 more rows</span><span class="w">
</span></code></pre></div></div>
<h3 id="filter-rows-with-filter">Filter rows with <code class="language-plaintext highlighter-rouge">filter()</code>:</h3>
<p><code class="language-plaintext highlighter-rouge">filter()</code> allows you to subset observations based on their values. The first argument is the name of the data frame. The second and subsequent arguments are the expressions that filter the data frame. For example, we can select all flights on January 1st with:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; # A tibble: 842 x 19</span><span class="w">
</span><span class="c1">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><span class="w">
</span><span class="c1">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><span class="w">
</span><span class="c1">#&gt; 1  2013     1     1      517            515         2      830            819</span><span class="w">
</span><span class="c1">#&gt; 2  2013     1     1      533            529         4      850            830</span><span class="w">
</span><span class="c1">#&gt; 3  2013     1     1      542            540         2      923            850</span><span class="w">
</span><span class="c1">#&gt; 4  2013     1     1      544            545        -1     1004           1022</span><span class="w">
</span><span class="c1">#&gt; 5  2013     1     1      554            600        -6      812            837</span><span class="w">
</span><span class="c1">#&gt; 6  2013     1     1      554            558        -4      740            728</span><span class="w">
</span><span class="c1">#&gt; # … with 836 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,</span><span class="w">
</span><span class="c1">#&gt; #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span><span class="w">
</span><span class="c1">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span><span class="w">
</span></code></pre></div></div>
<p>It’s much more efficient that subsetting in data.frame.</p>

<p><code class="language-plaintext highlighter-rouge">dplyr</code> functions never modify their inputs, so if you want to save the result, you’ll need to use the assignment operator, <code class="language-plaintext highlighter-rouge">&lt;-</code>:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>The following code finds all flights that departed in November or December:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>A useful short-hand for this problem is <code class="language-plaintext highlighter-rouge">x %in% y</code>. This will select every row where <code class="language-plaintext highlighter-rouge">x</code> is one of the values in <code class="language-plaintext highlighter-rouge">y</code>. We could use it to rewrite the code above:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<h3 id="exercises">Exercises</h3>
<p>Find all flights that</p>
<ul>
  <li>Had an arrival delay of two or more hours</li>
  <li>Flew to Houston (<code class="language-plaintext highlighter-rouge">IAH</code> or <code class="language-plaintext highlighter-rouge">HOU</code>)</li>
  <li>Were operated by United, American, or Delta</li>
  <li>Arrived more than two hours late, but didn’t leave late</li>
</ul>

<p>How many flights have a missing dep_time?</p>

<h3 id="arrange-rows-with-arrange">Arrange rows with <code class="language-plaintext highlighter-rouge">arrange()</code>:</h3>
<p><code class="language-plaintext highlighter-rouge">arrange()</code> works similarly to <code class="language-plaintext highlighter-rouge">filter()</code> except that instead of selecting rows, it changes their order. It takes a data frame and a set of column names (or more complicated expressions) to order by. If you provide more than one column name, each additional column will be used to break ties in the values of preceding columns:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">arrange</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; # A tibble: 336,776 x 19</span><span class="w">
</span><span class="c1">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><span class="w">
</span><span class="c1">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><span class="w">
</span><span class="c1">#&gt; 1  2013     1     1      517            515         2      830            819</span><span class="w">
</span><span class="c1">#&gt; 2  2013     1     1      533            529         4      850            830</span><span class="w">
</span><span class="c1">#&gt; 3  2013     1     1      542            540         2      923            850</span><span class="w">
</span><span class="c1">#&gt; 4  2013     1     1      544            545        -1     1004           1022</span><span class="w">
</span><span class="c1">#&gt; 5  2013     1     1      554            600        -6      812            837</span><span class="w">
</span><span class="c1">#&gt; 6  2013     1     1      554            558        -4      740            728</span><span class="w">
</span><span class="c1">#&gt; # … with 336,770 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span><span class="w">
</span><span class="c1">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span><span class="w">
</span><span class="c1">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span><span class="w">
</span></code></pre></div></div>
<p>Use <code class="language-plaintext highlighter-rouge">desc()</code> to re-order by a column in descending order:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">arrange</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; # A tibble: 336,776 x 19</span><span class="w">
</span><span class="c1">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><span class="w">
</span><span class="c1">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><span class="w">
</span><span class="c1">#&gt; 1  2013     1     9      641            900      1301     1242           1530</span><span class="w">
</span><span class="c1">#&gt; 2  2013     6    15     1432           1935      1137     1607           2120</span><span class="w">
</span><span class="c1">#&gt; 3  2013     1    10     1121           1635      1126     1239           1810</span><span class="w">
</span><span class="c1">#&gt; 4  2013     9    20     1139           1845      1014     1457           2210</span><span class="w">
</span><span class="c1">#&gt; 5  2013     7    22      845           1600      1005     1044           1815</span><span class="w">
</span><span class="c1">#&gt; 6  2013     4    10     1100           1900       960     1342           2211</span><span class="w">
</span><span class="c1">#&gt; # … with 336,770 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span><span class="w">
</span><span class="c1">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span><span class="w">
</span><span class="c1">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span><span class="w">
</span></code></pre></div></div>
<p>Missing values are always sorted at the end.</p>

<h3 id="exrcises">Exrcises</h3>
<p>How could you use arrange() to sort all missing values to the start? (Hint: use is.na()).</p>

<p>Sort flights to find the most delayed flights.</p>

<h3 id="questions">Questions?</h3>

<div style="text-align:center"><img src="https://media1.tenor.com/images/cd3ee8f2a22b429050b954cabbf81c6b/tenor.gif?itemid=14812024" width="250" /></div>

<h2 id="mock-interview-questions">Mock interview questions</h2>

<ul>
  <li>What variance inflation factor (VIF) in linear regression? What can we infer if the VIF for one predictor is larger than 5?</li>
  <li>Explain what precision and recall are. How do they relate to the ROC curve?</li>
</ul>

<hr />

  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>
          <!-- start of footer -->
          Fall 2020 &nbsp;-&nbsp;
          <a href="http://mlqmlq.github.io">Linquan Ma</a>
          <!-- end of footer -->
        </small></p>
      </footer>

    </div>

    
  </body>
</html>

