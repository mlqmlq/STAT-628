
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Discussion 7</title>
    <meta name="author" content="Linquan Ma">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://mlqmlq.github.io/STAT628/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="http://mlqmlq.github.io/STAT628/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="http://mlqmlq.github.io/STAT628/assets/themes/twitter/css/main.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->

    <!-- atom & rss feed -->
    <link href="nil" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="nil" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Data Science Practicum - STAT 628 - Fall 2020</a>
          <ul class="nav">
              <li><a href="/pages/schedule.html">schedule</a></li>
          </ul>

        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h2>Discussion 7 </h2>
</div>

<div class="row-fluid">
  <div class="span12">
    <h1 id="yelp-data-sentiment-analysis">Yelp data sentiment analysis</h1>

<h2 id="project-goals">Project Goals</h2>

<p>The two goals for the project are</p>
<ul>
  <li>
    <p>Provide useful, analytics to <strong>business owners</strong> on Yelp from the datasets provided and, based on these insights, propose data-driven, actionable decisions to said owners in order to improve their ratings on Yelp.</p>
  </li>
  <li>
    <p>Build a web dashboard/widget/web application that visualizes your analysis and makes it easier to understand for <strong>business owners</strong>.</p>
  </li>
</ul>

<h2 id="datasets">Datasets</h2>

<p>We included four JSON files for you. JSON files are the de-facto standard of transmitting data on the Web and this module will help you learn how to manipulate JSON files. The four JSON files are</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">review.json</code>: this contains the reviews. There are 942,027 entries of reviews.</li>
  <li><code class="language-plaintext highlighter-rouge">business.json</code>: this contains information about businesses. There are 36,327 entries of businesses.</li>
  <li><code class="language-plaintext highlighter-rouge">user.json</code>: this contains information about users. There are 272,024 entries of users.</li>
  <li><code class="language-plaintext highlighter-rouge">tip.json</code>: this contains information about tips written by users on a business. There are 129,571 tips generated by users.</li>
</ul>

<p>In this discussion, we will load JSON files into Python, combine <code class="language-plaintext highlighter-rouge">review.json</code> with <code class="language-plaintext highlighter-rouge">business.json</code>, and use the <code class="language-plaintext highlighter-rouge">nltk</code> module to parse the reviews.</p>

<p>For illustration purpose, I will sample the first 100,000 lines of reviews in shell:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">head</span> <span class="nt">-n</span> 100000 review_city.json <span class="o">&gt;&gt;</span> sample_review.json
</code></pre></div></div>

<p>All of today’s job was done in Python. If you want to use R and tidyverse, feel free to checkout this book: <a href="https://www.tidytextmining.com/index.html">Text Mining with R
</a>.</p>

<p>Then, we open a Jupyter Notebook and load <code class="language-plaintext highlighter-rouge">sample_review.json</code> and <code class="language-plaintext highlighter-rouge">business.json</code> into pandas dataframes using the <code class="language-plaintext highlighter-rouge">pd.read_json</code> command.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">review</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="s">'sample_review.json'</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">review</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">business</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_json</span><span class="p">(</span><span class="s">'business_city.json'</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">business</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<p>Then, similar to <code class="language-plaintext highlighter-rouge">SQL</code>, we can join tables in <code class="language-plaintext highlighter-rouge">pandas</code> using <code class="language-plaintext highlighter-rouge">pd.merge</code> command. For more merging pandas dataframes, check out <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html">here</a>.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">review</span><span class="p">,</span> <span class="n">business</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'business_id'</span><span class="p">)</span>
<span class="n">df_raw</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<p>Then, we use the <code class="language-plaintext highlighter-rouge">DataFrame.join</code> method to see how many rows and columns are there:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_raw</span><span class="p">.</span><span class="n">shape</span>
<span class="c1"># Output: (100000, 22)
</span></code></pre></div></div>
<p>Let’s look at the column names:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_raw</span><span class="p">.</span><span class="n">columns</span>
<span class="c1"># Output: Index(['review_id', 'user_id', 'business_id', 'stars_x', 'useful', 'funny',
#       'cool', 'text', 'date', 'name', 'address', 'city', 'state',
#       'postal_code', 'latitude', 'longitude', 'stars_y', 'review_count',
#       'is_open', 'attributes', 'categories', 'hours'],
#      dtype='object')
</span></code></pre></div></div>
<p>We can drop columns <code class="language-plaintext highlighter-rouge">review_id</code>, <code class="language-plaintext highlighter-rouge">user_id</code>, <code class="language-plaintext highlighter-rouge">funny</code>, <code class="language-plaintext highlighter-rouge">cool</code>, <code class="language-plaintext highlighter-rouge">date</code>, <code class="language-plaintext highlighter-rouge">latitude</code>, <code class="language-plaintext highlighter-rouge">longitude</code>, <code class="language-plaintext highlighter-rouge">is_open</code> because they can help little for our analysis:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'business_id'</span><span class="p">,</span> <span class="s">'review_id'</span><span class="p">,</span> <span class="s">'user_id'</span><span class="p">,</span> <span class="s">'funny'</span><span class="p">,</span> <span class="s">'cool'</span><span class="p">,</span> <span class="s">'date'</span><span class="p">,</span> <span class="s">'latitude'</span><span class="p">,</span> <span class="s">'longitude'</span><span class="p">,</span> <span class="s">'is_open'</span><span class="p">,</span> <span class="s">'review_count'</span><span class="p">,</span> <span class="s">'hours'</span><span class="p">])</span>
</code></pre></div></div>

<p>Let now check how many records are for Madison restaurants from the first 100,000 reviews:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">city</span> <span class="o">==</span> <span class="s">'Madison'</span><span class="p">)</span>
<span class="c1"># 11792
</span></code></pre></div></div>
<p>Suppose we want to study the restaurants in Madison, we can subset the dataset like this:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Madison</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">.</span><span class="n">city</span> <span class="o">==</span> <span class="s">'Madison'</span><span class="p">]</span>
<span class="n">Madison</span> <span class="o">=</span> <span class="n">Madison</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'city'</span><span class="p">,</span> <span class="s">'state'</span><span class="p">])</span>
</code></pre></div></div>

<p>Re-index the <code class="language-plaintext highlighter-rouge">Madison</code> dataframe:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Madison</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="nltk-natural-language-toolkit">nltk (Natural Language Toolkit)</h2>

<p>Then, we turn our focus on the reviews itself. We will use the <a href="https://www.nltk.org/">nltk</a> package.</p>

<ul>
  <li><strong>Popularity</strong>: NLTK is one of the leading platforms for dealing with language data.</li>
  <li><strong>Simplicity</strong>: Provides easy-to-use APIs for a wide variety of text preprocessing methods.</li>
</ul>

<p>Firstly, we assign the column <code class="language-plaintext highlighter-rouge">text</code> to a new variable and convert it to a list. We then convert each review to lower cases using the <code class="language-plaintext highlighter-rouge">string.lower()</code> method:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Madison</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>
<p>Then, we remove punctuations. We save only the characters that are not punctuation, which can be checked by using <code class="language-plaintext highlighter-rouge">string.punctuation</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">string</span>
<span class="k">print</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">punctuation</span><span class="p">)</span>
<span class="c1"># !"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^_`{|}~
</span></code></pre></div></div>

<p>We remove the punctuations using <a href="https://realpython.com/list-comprehension-python/">list comprehensions</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">punctuation</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">text</span><span class="p">]</span>
<span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># 'easily my favorite place to eat in madison  great laothai food  curries are fantastic and make sure to start with a soup  theyre always good  tip place is tiny and you will wait  either get carry out or head across the street to the weary traveler to grab a beer while you wait for your table'
</span>
</code></pre></div></div>

<p>After that, strings can be tokenized into tokens via <code class="language-plaintext highlighter-rouge">nltk.word_tokenize</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">text_p</span><span class="p">)</span>
</code></pre></div></div>
<p>If <code class="language-plaintext highlighter-rouge">nltk</code> throws an error, perhaps you need to run the following command:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nltk</span><span class="p">.</span><span class="n">download</span><span class="p">(</span><span class="s">'punkt'</span><span class="p">)</span>
</code></pre></div></div>
<p>In this way, <code class="language-plaintext highlighter-rouge">words</code> contains all the words for each of the review.</p>

<p>Then, we’d better to one more step of stop word filtering, to exclude the words appearing everywhere like <strong>a, an, the, I, you, can</strong>.</p>

<p>There is a list of stopwords in the <code class="language-plaintext highlighter-rouge">nltk</code> package, and we can access them through</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="n">stop_words</span> <span class="o">=</span> <span class="n">stopwords</span><span class="p">.</span><span class="n">words</span><span class="p">(</span><span class="s">'english'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">stop_words</span><span class="p">)</span>
</code></pre></div></div>

<p>To combine  different forms of a word together, such as organize, organizes, and organizing, we use the technique of lemmatization. Firstly, we need to download the corpus <code class="language-plaintext highlighter-rouge">wordnet</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nltk</span><span class="p">.</span><span class="n">download</span><span class="p">(</span><span class="s">'wordnet'</span><span class="p">)</span>
</code></pre></div></div>

<p>Then we perform lemmatization:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">nltk.stem.wordnet</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<span class="n">lmtzr</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
<span class="n">lemmatized_words</span> <span class="o">=</span> <span class="p">[[</span><span class="n">lmtzr</span><span class="p">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">filtered_words</span><span class="p">]</span>
</code></pre></div></div>

<p>Then, we can create a corpus based on <code class="language-plaintext highlighter-rouge">lemmatized_words</code>.</p>

<h2 id="interview-questions">Interview questions:</h2>

<ol>
  <li>
    <p>Suppose we do a simple linear regression with intercept, and the sample variance of $x_i$ and $y_i$ equals to each other. Consider the following two model: $y = \hat a_1 + \hat b_1 x$; $x = \hat a_2 + \hat b_2 y$. (1) What are the relationships between $\hat b_1$ and $\hat b_2$? (2) What are the relationships between $R^2$ when we run <code class="language-plaintext highlighter-rouge">y ~ x</code> and <code class="language-plaintext highlighter-rouge">x ~ y</code>? (3) What are the relationship between $\hat b_1$, $\hat b_2$ and $R^2$?</p>
  </li>
  <li>
    <p>Find an example such that $\text{Cor}(x_1, y) &lt; 0.1$, $\text{Cor}(x_2, y) = 0$, but the $R^2$ for <code class="language-plaintext highlighter-rouge">y ~ x1 + x2</code> equals to 1.</p>
  </li>
</ol>

<hr />

  </div>
</div>

<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
inlineMath: [['$','$'], ['\\(','\\)']],
processEscapes: true},
jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "[Contrib]/a11y/accessibility-menu.js"],
TeX: {
extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"],
equationNumbers: {
autoNumber: "AMS"
}
}
});
</script>
      </div>
      <hr>
      <footer>
        <p>
          <!-- start of footer -->
          Fall 2020 &nbsp;-&nbsp;
          <a href="http://mlqmlq.github.io">Linquan Ma</a>
          <!-- end of footer -->
        </small></p>
      </footer>

    </div>

    
  </body>
</html>

